var T=Object.defineProperty;var b=(e,t,n)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var c=(e,t,n)=>(b(e,typeof t!="symbol"?t+"":t,n),n);import{f as _}from"./storage.c74628fa.js";import{S as h,a as g,b as s,L as y,c as L}from"./constants.e6c55d61.js";function d(e,t,n){const r=e.children;for(let o=0;o<r.length;o++){const i=r[o];if(i.getAttribute(t)===n)return i;const l=d(i,t,n);if(l)return l}return null}class f{constructor(t,n){c(this,"pageType");c(this,"pageUrl");this.pageType=t,this.pageUrl=n}}class m extends f{constructor(n,r,o=!1){super(n,r);c(this,"openedTask");this.openedTask=o}}function E(e){const t=e;if(t.includes(h)){let n=t.includes(g);return new m("Sidbox",t,n)}return new f("other",t)}const S=["Name","Task_Number_Text__c","Details__c","Expected_Functionality__c","Expected_Result__c","Developer_Notes2__c"];function x(){let e=document.querySelectorAll(".test-id__field-label-container.slds-form-element__label"),n=Array.from(e).map(o=>o.parentElement).map(o=>{let i=o.parentElement.attributes.getNamedItem("data-target-selection-name");for(let l of S)if(i.textContent.includes(l))return[o,l];return null});return n=n.filter(o=>o),n.map(([o,i])=>I(o,i))}function I(e,t){let n=d(e,"data-output-element-id","output-field");return n!=null?t=="Details__c"?(console.log(n.innerHTML),{name:t,content:n.innerHTML}):{name:t,content:n.textContent}:null}let a=null;(async()=>{const e={action:s.getActiveTab},t=await chrome.runtime.sendMessage(e);k(t)})();chrome.runtime.onMessage.addListener((e,t,n)=>{u(e.data.url)});function k(e){e.action===s.getActiveTab?w(e):e.action===s.historyStateUpdated&&M(e)}function w(e){u(e.data.url)}function M(e){u(e.data.url)}function u(e){a=E(e),a instanceof m&&a.openedTask&&_.get().then(t=>{t.task_link&&v(a),t.experimental&&A()})}function v(e){p(L).then(t=>{if(t instanceof HTMLElement){let n=t.innerHTML,r=document.createElement("a");r.href=e.pageUrl,r.innerHTML=n,r.onclick=o=>{o.preventDefault();const i=new ClipboardItem({"text/plain":new Blob([t.innerText],{type:"text/plain"}),"text/html":new Blob([r.outerHTML],{type:"text/html"})});navigator.clipboard.write([i])},r.ondblclick=o=>{let i=document.createElement("b");i.innerHTML=r.outerHTML,o.preventDefault();const l=new ClipboardItem({"text/plain":new Blob([t.innerText],{type:"text/plain"}),"text/html":new Blob([i.outerHTML],{type:"text/html"})});setTimeout(()=>{navigator.clipboard.write([l])},100)},t.innerHTML="",t.appendChild(r)}})}function A(){p(".test-id__field-label-container.slds-form-element__label").then(e=>{e instanceof HTMLElement&&R(H())})}function p(e){return new Promise(t=>{if(document.querySelector(e))return t(document.querySelector(e));const n=new MutationObserver(()=>{document.querySelector(e)&&(t(document.querySelector(e)),n.disconnect())});n.observe(document.body,{subtree:!0,childList:!0})})}function H(){let e=x();console.log(e[0]);let t={url:a.pageUrl,fields:e};fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(n=>console.log(n)).catch(n=>console.log(n))}function R(e,t=250){let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(this,r)},t)}}
